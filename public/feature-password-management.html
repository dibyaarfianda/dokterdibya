<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>Feature: Set & Change Password</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 40px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2em;
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        .content {
            padding: 30px;
        }
        .section {
            margin-bottom: 30px;
        }
        .section h2 {
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .feature-box {
            background: #f8f9ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 15px 0;
            border-radius: 6px;
        }
        .feature-box h3 {
            margin-top: 0;
            color: #667eea;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin: 15px 0;
        }
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 3px;
        }
        .badge-new { background: #48bb78; color: white; }
        .badge-endpoint { background: #4299e1; color: white; }
        .badge-ui { background: #ed8936; color: white; }
        .step-list {
            counter-reset: step-counter;
            list-style: none;
            padding-left: 0;
        }
        .step-list li {
            counter-increment: step-counter;
            position: relative;
            padding-left: 50px;
            margin-bottom: 20px;
        }
        .step-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: #667eea;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .screenshot-placeholder {
            background: #f7fafc;
            border: 2px dashed #cbd5e0;
            padding: 40px;
            text-align: center;
            color: #718096;
            border-radius: 6px;
            margin: 15px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        th {
            background: #f7fafc;
            font-weight: 600;
            color: #667eea;
        }
        .success-box {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .info-box {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Set & Change Password Feature</h1>
            <p>Allow patients to set password after Google Sign-In and change password anytime</p>
        </div>

        <div class="content">
            <!-- Overview -->
            <div class="section">
                <h2>üìã Overview</h2>
                <div class="success-box">
                    <strong>‚úÖ Feature Implemented Successfully!</strong><br>
                    Patients can now set password after Google Sign-In and change it later in their dashboard profile.
                </div>
                
                <p><strong>Use Cases:</strong></p>
                <ul>
                    <li>üéØ <strong>Google Sign-In Users:</strong> Set password to enable email/password login as backup</li>
                    <li>üîÑ <strong>Existing Users:</strong> Change password for security</li>
                    <li>üõ°Ô∏è <strong>Security:</strong> All passwords hashed with bcrypt (10 rounds)</li>
                </ul>
            </div>

            <!-- Backend Endpoints -->
            <div class="section">
                <h2>üîå Backend Endpoints</h2>
                
                <div class="feature-box">
                    <h3><span class="badge badge-endpoint">POST</span> /api/patients/set-password</h3>
                    <p><strong>Purpose:</strong> Set password for first time (Google Sign-In users)</p>
                    
                    <p><strong>Request Body:</strong></p>
                    <div class="code-block">
{
  "password": "newpassword123",
  "confirm_password": "newpassword123"
}
                    </div>
                    
                    <p><strong>Validation:</strong></p>
                    <ul>
                        <li>‚úÖ Both fields required</li>
                        <li>‚úÖ Passwords must match</li>
                        <li>‚úÖ Minimum 6 characters</li>
                        <li>‚úÖ JWT authentication required</li>
                    </ul>
                    
                    <p><strong>Response (200):</strong></p>
                    <div class="code-block">
{
  "success": true,
  "message": "Password berhasil diatur. Anda sekarang dapat login dengan email dan password."
}
                    </div>
                </div>

                <div class="feature-box">
                    <h3><span class="badge badge-endpoint">POST</span> /api/patients/change-password</h3>
                    <p><strong>Purpose:</strong> Change existing password (requires old password)</p>
                    
                    <p><strong>Request Body:</strong></p>
                    <div class="code-block">
{
  "old_password": "oldpassword123",
  "new_password": "newpassword456",
  "confirm_password": "newpassword456"
}
                    </div>
                    
                    <p><strong>Validation:</strong></p>
                    <ul>
                        <li>‚úÖ All fields required</li>
                        <li>‚úÖ Old password must be correct</li>
                        <li>‚úÖ New passwords must match</li>
                        <li>‚úÖ Minimum 6 characters</li>
                        <li>‚úÖ Must have existing password</li>
                    </ul>
                    
                    <p><strong>Error Cases:</strong></p>
                    <table>
                        <tr>
                            <th>Status</th>
                            <th>Scenario</th>
                            <th>Message</th>
                        </tr>
                        <tr>
                            <td>400</td>
                            <td>No password set yet</td>
                            <td>Anda belum pernah set password. Gunakan fitur "Set Password"</td>
                        </tr>
                        <tr>
                            <td>401</td>
                            <td>Wrong old password</td>
                            <td>Password lama tidak valid</td>
                        </tr>
                        <tr>
                            <td>400</td>
                            <td>Passwords don't match</td>
                            <td>Password baru dan konfirmasi tidak cocok</td>
                        </tr>
                    </table>
                </div>

                <div class="feature-box">
                    <h3><span class="badge badge-endpoint">GET</span> /api/patients/profile (Updated)</h3>
                    <p><strong>New Field Added:</strong></p>
                    <div class="code-block">
{
  "user": {
    "id": 108,
    "fullname": "Dibya Arfianda",
    "email": "dibya.revu@gmail.com",
    "has_password": 1,  ‚Üê NEW FIELD
    ...
  }
}
                    </div>
                    <p><code>has_password</code>: 1 if user has password, 0 if not (Google-only account)</p>
                </div>
            </div>

            <!-- Frontend UI -->
            <div class="section">
                <h2>üé® Frontend UI (Patient Dashboard)</h2>
                
                <div class="feature-box">
                    <h3><span class="badge badge-ui">NEW</span> Password Button</h3>
                    <p><strong>Location:</strong> Patient Dashboard ‚Üí Profile Section</p>
                    <p><strong>Dynamic Text:</strong></p>
                    <ul>
                        <li>üÜï <strong>"Set Password"</strong> - If user has no password yet (Google Sign-In)</li>
                        <li>üîÑ <strong>"Ubah Password"</strong> - If user already has password</li>
                    </ul>
                    
                    <div class="code-block">
&lt;button onclick="openPasswordModal()" id="password-btn"&gt;
    &lt;i class="fa fa-lock"&gt;&lt;/i&gt; 
    &lt;span id="password-btn-text"&gt;Set Password&lt;/span&gt;
&lt;/button&gt;
                    </div>
                </div>

                <div class="feature-box">
                    <h3><span class="badge badge-ui">NEW</span> Password Modal</h3>
                    <p><strong>Two Modes:</strong></p>
                    
                    <table>
                        <tr>
                            <th>Mode</th>
                            <th>Fields</th>
                            <th>Info Text</th>
                        </tr>
                        <tr>
                            <td><strong>Set Password</strong></td>
                            <td>
                                ‚Ä¢ Password<br>
                                ‚Ä¢ Confirm Password
                            </td>
                            <td>"Setelah set password, Anda dapat login menggunakan email dan password"</td>
                        </tr>
                        <tr>
                            <td><strong>Change Password</strong></td>
                            <td>
                                ‚Ä¢ Old Password<br>
                                ‚Ä¢ New Password<br>
                                ‚Ä¢ Confirm Password
                            </td>
                            <td>"Masukkan password lama dan password baru untuk mengubah password Anda"</td>
                        </tr>
                    </table>
                    
                    <p><strong>Features:</strong></p>
                    <ul>
                        <li>‚úÖ Real-time validation</li>
                        <li>‚úÖ Password length indicator (min 6 chars)</li>
                        <li>‚úÖ Error messages in-modal</li>
                        <li>‚úÖ Success confirmation</li>
                        <li>‚úÖ Auto-close after success</li>
                    </ul>
                </div>
            </div>

            <!-- User Flow -->
            <div class="section">
                <h2>üîÑ User Flows</h2>
                
                <div class="feature-box">
                    <h3>Scenario 1: Google Sign-In User (First Time)</h3>
                    <ol class="step-list">
                        <li>
                            <strong>Register via Google</strong><br>
                            User signs up using Google account (no password in database)
                        </li>
                        <li>
                            <strong>Complete Profile</strong><br>
                            Redirect to complete-profile.html to fill birth date, etc.
                        </li>
                        <li>
                            <strong>Access Dashboard</strong><br>
                            Dashboard loads, detects <code>has_password: 0</code>
                        </li>
                        <li>
                            <strong>See "Set Password" Button</strong><br>
                            Button text shows "Set Password" in profile section
                        </li>
                        <li>
                            <strong>Click & Set Password</strong><br>
                            Modal opens with 2 fields (password + confirm)
                        </li>
                        <li>
                            <strong>Success!</strong><br>
                            Button changes to "Ubah Password"<br>
                            User can now login with email + password
                        </li>
                    </ol>
                </div>

                <div class="feature-box">
                    <h3>Scenario 2: Email/Password User (Change Password)</h3>
                    <ol class="step-list">
                        <li>
                            <strong>Login to Dashboard</strong><br>
                            User has existing password, sees "Ubah Password" button
                        </li>
                        <li>
                            <strong>Click "Ubah Password"</strong><br>
                            Modal opens with 3 fields (old + new + confirm)
                        </li>
                        <li>
                            <strong>Enter Passwords</strong><br>
                            Validates old password before allowing change
                        </li>
                        <li>
                            <strong>Save Changes</strong><br>
                            Password updated in database (bcrypt hashed)
                        </li>
                        <li>
                            <strong>Success Confirmation</strong><br>
                            Modal shows success message and auto-closes
                        </li>
                    </ol>
                </div>
            </div>

            <!-- Security -->
            <div class="section">
                <h2>üõ°Ô∏è Security Features</h2>
                
                <table>
                    <tr>
                        <th>Feature</th>
                        <th>Implementation</th>
                    </tr>
                    <tr>
                        <td><strong>Password Hashing</strong></td>
                        <td>bcrypt with 10 salt rounds</td>
                    </tr>
                    <tr>
                        <td><strong>Authentication</strong></td>
                        <td>JWT token required (verifyToken middleware)</td>
                    </tr>
                    <tr>
                        <td><strong>Password Not Exposed</strong></td>
                        <td>Deleted from profile API response</td>
                    </tr>
                    <tr>
                        <td><strong>Old Password Verification</strong></td>
                        <td>Required before changing password</td>
                    </tr>
                    <tr>
                        <td><strong>Minimum Length</strong></td>
                        <td>6 characters enforced</td>
                    </tr>
                    <tr>
                        <td><strong>Confirmation Match</strong></td>
                        <td>Both frontend and backend validation</td>
                    </tr>
                </table>
            </div>

            <!-- Testing -->
            <div class="section">
                <h2>üß™ Testing Checklist</h2>
                
                <div class="info-box">
                    <strong>Test Account:</strong> User with Google Sign-In (no password initially)
                </div>

                <h3>Test Set Password:</h3>
                <ul>
                    <li>‚òê Login via Google</li>
                    <li>‚òê Go to Dashboard ‚Üí Profile section</li>
                    <li>‚òê Verify button text is "Set Password"</li>
                    <li>‚òê Click button ‚Üí modal opens</li>
                    <li>‚òê Try empty fields ‚Üí validation error</li>
                    <li>‚òê Try mismatched passwords ‚Üí error</li>
                    <li>‚òê Try short password (< 6 chars) ‚Üí error</li>
                    <li>‚òê Enter valid password ‚Üí success</li>
                    <li>‚òê Verify button changes to "Ubah Password"</li>
                    <li>‚òê Logout and login with email + new password</li>
                </ul>

                <h3>Test Change Password:</h3>
                <ul>
                    <li>‚òê Login to dashboard (user with existing password)</li>
                    <li>‚òê Verify button text is "Ubah Password"</li>
                    <li>‚òê Click button ‚Üí modal shows 3 fields</li>
                    <li>‚òê Try wrong old password ‚Üí error</li>
                    <li>‚òê Try mismatched new passwords ‚Üí error</li>
                    <li>‚òê Enter correct old + valid new ‚Üí success</li>
                    <li>‚òê Logout and login with new password</li>
                </ul>
            </div>

            <!-- Files Modified -->
            <div class="section">
                <h2>üìÅ Files Modified</h2>
                
                <table>
                    <tr>
                        <th>File</th>
                        <th>Changes</th>
                    </tr>
                    <tr>
                        <td><code>backend/routes/patients-auth.js</code></td>
                        <td>
                            ‚Ä¢ Added POST /set-password endpoint<br>
                            ‚Ä¢ Added POST /change-password endpoint<br>
                            ‚Ä¢ Updated GET /profile to include has_password
                        </td>
                    </tr>
                    <tr>
                        <td><code>public/patient-dashboard.html</code></td>
                        <td>
                            ‚Ä¢ Added password button in profile section<br>
                            ‚Ä¢ Added password modal (dynamic 2 modes)<br>
                            ‚Ä¢ Added openPasswordModal() function<br>
                            ‚Ä¢ Added savePassword() function<br>
                            ‚Ä¢ Updated loadUserProfile() to detect password status
                        </td>
                    </tr>
                    <tr>
                        <td><code>PM2 Backend</code></td>
                        <td>Restarted (48 total restarts)</td>
                    </tr>
                </table>
            </div>

            <!-- Summary -->
            <div class="section">
                <h2>‚ú® Summary</h2>
                
                <div class="success-box">
                    <h3 style="margin-top: 0;">‚úÖ Implementation Complete!</h3>
                    
                    <p><strong>What's New:</strong></p>
                    <ul>
                        <li>üÜï Set Password for Google Sign-In users</li>
                        <li>üîÑ Change Password for existing users</li>
                        <li>üéØ Dynamic UI based on password status</li>
                        <li>üõ°Ô∏è Full validation & security</li>
                        <li>üì± Mobile-responsive modal design</li>
                    </ul>
                    
                    <p><strong>User Benefits:</strong></p>
                    <ul>
                        <li>‚úÖ Google users can set backup login method</li>
                        <li>‚úÖ All users can change password anytime</li>
                        <li>‚úÖ Clear UI feedback (button text changes)</li>
                        <li>‚úÖ Secure password management</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
